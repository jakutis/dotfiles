#!/usr/bin/env bash

if [ -s "$HOME/.varia/awesome-battery.pid" ]
then
    kill -9 "$(cat "$HOME/.varia/awesome-battery.pid")"
fi
echo "$$" > "$HOME/.varia/awesome-battery.pid"

BAT="$(cat "$HOME/.varia/bat")"

while true
do
    if [ "$(cat /sys/class/power_supply/$BAT/status)" = "Charging" ]
    then
        awesome-client <<< "mybatterywidget.text = '<span color=\"green\">$(cat /sys/class/power_supply/$BAT/energy_now)</span>'"
    else
        awesome-client <<< "mybatterywidget.text = '<span color=\"red\">$(cat /sys/class/power_supply/$BAT/energy_now)</span>'"
    fi
    sleep 3
done
