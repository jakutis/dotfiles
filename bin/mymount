#!/usr/bin/env bash

if [ -z "$1" ]
then
    echo "Please specify the mount"
    exit 1
fi

MOUNT="$1"
if [[ "$MOUNT" =~ : ]]
then
    SUBMOUNT="${MOUNT#*:}"
    MOUNT="${MOUNT%:*}"
fi

DIR="/mnt/$MOUNT"

if [ -z "$(mount | grep " $DIR ")" ]
then
    echo "Mounting $DIR"
    su -c "mkdir -p "$DIR";chown $USER: "$DIR""
    if [ "$MOUNT" = "desktop" ]
    then
        wake "$(cat "$HOME/.varia/desktop/network/ip-wake")" "$(cat "$HOME/.varia/desktop/network/mac")"
        sshfs -o reconnect -p "$(cat "$HOME/.varia/desktop/network/port")" "$(cat "$HOME/.varia/desktop/network/user")@$(cat "$HOME/.varia/desktop/network/ip"):/" "$DIR"
    elif [ "$MOUNT" = "server" ]
    then
        sshfs -o reconnect tahu@jakut.is:/ "$DIR"
    elif [ "$MOUNT" = "ipad" ]
    then
        if [ -z "$SUBMOUNT" ]
        then
            ifuse "$DIR"
        else
            ifuse --documents "$SUBMOUNT" "$DIR"
        fi
    elif [ "$MOUNT" = "floppy" ]
    then
        MOUNT="$(ls --sort=time /dev/sd?|head -n 1)"
        MOUNT="$(ls --sort=none ${MOUNT}*|tail -n 1)"
        su -c "mount -o uid=$(id -u) "$MOUNT" "$DIR""
    else
        su -c "mount "$DIR""
    fi
else
    echo "Unmounting $DIR"
    su -c "umount -f "$DIR""
fi
