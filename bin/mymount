#!/usr/bin/env bash

if [ -z "$1" ]
then
    echo "Please specify the mount"
    exit 1
fi

MOUNT="$1"
if [[ "$MOUNT" =~ : ]]
then
    SUBMOUNT="${MOUNT#*:}"
    MOUNT="${MOUNT%:*}"
fi

DIR="/mnt/$MOUNT"

if [ -z "$(mount | grep " $DIR ")" ]
then
    echo "Mounting $DIR"
    if [ "$MOUNT" = "desktop" ]
    then
        su -c "mkdir -p "$DIR";chown $USER: "$DIR""
        wake "$(cat "$HOME/.varia/desktop/network/ip-wake")" "$(cat "$HOME/.varia/desktop/network/mac")"
        sshfs -o reconnect -p "$(cat "$HOME/.varia/desktop/network/port")" "$(cat "$HOME/.varia/desktop/network/user")@$(cat "$HOME/.varia/desktop/network/ip"):/" "$DIR"
    elif [ "$MOUNT" = "server" ]
    then
        su -c "mkdir -p "$DIR";chown $USER: "$DIR""
        sshfs -o reconnect jakutis@jakut.is:/ "$DIR"
    elif [ "$MOUNT" = "android" ]
    then
        nohup go-mtpfs -android=true /mnt/android 1>/dev/null 2>&1 &
    elif [ "$MOUNT" = "ipad" ]
    then
        su -c "mkdir -p "$DIR";chown $USER: "$DIR""
        if [ -z "$SUBMOUNT" ]
        then
            ifuse "$DIR"
        else
            ifuse --documents "$SUBMOUNT" "$DIR"
        fi
    elif [ "$MOUNT" = "floppy" ]
    then
        MOUNT="$(ls --sort=time /dev/sd?|head -n 1)"
        MOUNT="$(ls --sort=none ${MOUNT}*|tail -n 1)"
        su -c "mkdir -p "$DIR" && chown $USER: "$DIR" && mount -o uid=$(id -u) "$MOUNT" "$DIR""
    else
        su -c "mkdir -p "$DIR" && chown $USER: "$DIR" && mount "$DIR""
    fi
else
    echo "Unmounting $DIR"
    if [ "$MOUNT" = "android" ]
    then
      fusermount -u "$DIR"
    else
      su -c "umount -f "$DIR""
    fi
fi
