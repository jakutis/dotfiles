#!/usr/bin/env bash

if [ -s "$HOME/.varia/awesome-ip.pid" ]
then
    kill -9 "$(cat "$HOME/.varia/awesome-ip.pid")"
fi
echo "$$" > "$HOME/.varia/awesome-ip.pid"

while true
do
    IP="$(curl --connect-timeout 2 "http://78.58.149.106/" 2>/dev/null)"

    if [ -n "$IP" ]
    then
        awesome-client <<< "mynetwidget.text='<span color=\"green\"> ${IP} </span>'"
 else
        awesome-client <<< "mynetwidget.text='<span color=\"red\"> offline </span>'"
    fi
    sleep 3
done
