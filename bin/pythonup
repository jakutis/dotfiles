#!/usr/bin/env bash

NEWVERSION="$1"

if [ -z "$NEWVERSION" ]
then
    echo "Please specify version" >&2
    exit 1
fi

PACKAGES="$HOME/.pythonpackages"
if ! [ -e "$PACKAGES" ]
then
    echo "Please create a file "$PACKAGES" with a list of global packages to install"
    exit 1
fi

cd "$(pyenv root)" && git pull --rebase && cd - || exit 1
eval "$(pyenv init -)" && pyenv install "$NEWVERSION" && pyenv global "$NEWVERSION" && pyenv shell $(pyenv global) || exit 1

for PACKAGE in $(cat "$PACKAGES")
do
    pip install $PACKAGE || exit 1
done
