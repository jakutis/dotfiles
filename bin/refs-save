#!/usr/bin/env bash

if [ -z "$1" ]
then
    echo "Error: references file not specified." >&2
    exit 1
fi

REFERENCES="$(realpath "$1")"

if ! [ -e "$REFERENCES" ]
then
    echo "Error: references file \"$REFERENCES\" does not exist." >&2
    exit 1
fi

if [ -z "$2" ]
then
    echo "Error: references destination directory not specified." >&2
    exit 1
fi

DIR="$(realpath "$2")"

if ! [ -e "$DIR" ]
then
    echo "Error: references destination directory \"$DIR\" does not exist." >&2
    exit 1
fi

cat "$REFERENCES" | grep -v '^#' | (
    PDFS=()
    while read PDF
    do
        PDFS=("${PDFS[@]}" "$PDF.pdf")
    done
    cd "$HOME/etc/storage/books"
    cp -L "${PDFS[@]}" "$DIR"
)
