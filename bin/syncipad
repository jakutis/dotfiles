#!/usr/bin/env bash

IPAD_ROOT="/mnt/ipad"
IPAD="$IPAD_ROOT/Books/Purchases"
DESKTOP="$HOME/Desktop/books/ipad"

eval "$(pyenv init -)" && pyenv shell 3.5.2

diff <(ls "$DESKTOP" | sort) <(ls "$IPAD" | sort) | grep -e '<' | cut -b 3- | while read BOOK
do
  echo "Copying from Desktop to iPad: $BOOK"
  book2pad -d "$IPAD_ROOT" "$DESKTOP/$BOOK" 1>/dev/null || exit 1
done

diff <(ls "$DESKTOP" | sort) <(ls "$IPAD" | sort) | grep -e '>' | cut -b 3- | while read BOOK
do
  echo "Copying from iPad to Desktop: $BOOK"
  cp "$IPAD/$BOOK" "$DESKTOP/$BOOK"
done
