#!/usr/bin/env bash

FILE="$1"

if [ -z "$FILE" ]
then
    echo "Error: please specify a filename" >&2
    exit 1
fi

REALFILE="$(realpath "$FILE")"

if [ -b "$REALFILE" ]
then
    lsblk "$REALFILE" | less
elif [ -f "$REALFILE" ]
then
    MIME="$(file --dereference --brief --mime-type "$FILE")"
    EXT="$(echo "$FILE" | awk -F . '{print $NF}')"
    case "$MIME" in
        "text/plain" | "text/x-c" | "text/x-python" | "text/x-c++" | "text/x-asm" | "message/rfc822")
            less "$FILE"
            ;;
        "text/html")
            www "$FILE"
            ;;
        "audio/x-flac" | "audio/mpeg" | "video/mp4" | "video/x-flv" | "audio/x-wav" | "video/quicktime" | "video/x-matroska")
            mplayer "$FILE"
            ;;
        "image/gif" | "image/jpeg" | "image/vnd.adobe.photoshop" | "image/tiff" | "image/png")
            mirage "$FILE"
            ;;
        "application/x-font-ttf")
            kfontview "$FILE"
            ;;
        "application/x-bittorrent")
            if [ -n "$(which transmission-show 2>/dev/null)" ]
            then
                transmission-show "$FILE"
            else
                transmissioncli --info "$FILE"
            fi
            ;;
        "application/pdf" | "image/vnd.djvu" | "application/epub+zip" | "application/postscript")
            okular "$FILE"
            ;;
        "application/msword" | "application/vnd.ms-excel" | "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" | "application/vnd.ms-powerpoint")
            libreoffice "$FILE"
            ;;
        "application/x-bzip2" | "application/x-gzip")
            ls -lha "$FILE"
            ;;
        "application/vnd.ms-cab-compressed")
            cabextract -l "$FILE"
            ;;
        "application/x-rar")
            rar v "$FILE"
            ;;
        "application/x-7z-compressed")
            7z l "$FILE"
            ;;
        "application/zip")
            if [ "$EXT" == "cbz" ]
            then
                okular "$FILE"
            else
                zip --show-just-unicode --verbose --show-files "$FILE"
            fi
            ;;
        "application/octet-stream" | "application/x-dosexec")
            if [ "$(file --brief "$FILE")" = "MS Windows HtmlHelp Data" ]
            then
                xchm "$FILE"
            else
                hexdump -C "$FILE" | less
            fi
            ;;
        *)
            echo "Error: unknown mime type "$MIME"" >&2
            exit 1
            ;;
    esac
elif [ -d "$REALFILE" ]
then
    find "$REALFILE" | less
elif ! [ -e "$REALFILE" ]
then
    echo "Error: file "$REALFILE" does not exist" >&2
    exit 1
else
    ls -lha "$REALFILE" | less
fi
